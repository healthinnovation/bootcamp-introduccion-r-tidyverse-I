<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introducción a R y Tidyverse</title>
    <meta charset="utf-8" />
    <meta name="author" content="Laboratorio de Innovación en Salud" />
    <meta name="date" content="2022-04-02" />
    <script src="sesion_03_files/header-attrs/header-attrs.js"></script>
    <link href="sesion_03_files/tile-view/tile-view.css" rel="stylesheet" />
    <script src="sesion_03_files/tile-view/tile-view.js"></script>
    <script src="sesion_03_files/js-cookie/js.cookie.js"></script>
    <script src="sesion_03_files/peerjs/peerjs.min.js"></script>
    <script src="sesion_03_files/tiny.toast/toast.min.js"></script>
    <link href="sesion_03_files/xaringanExtra-broadcast/broadcast.css" rel="stylesheet" />
    <script src="sesion_03_files/xaringanExtra-broadcast/broadcast.js"></script>
    <script src="sesion_03_files/fabric/fabric.min.js"></script>
    <link href="sesion_03_files/xaringanExtra-scribble/scribble.css" rel="stylesheet" />
    <script src="sesion_03_files/xaringanExtra-scribble/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#FF0000"],"pen_size":3,"eraser_size":30,"palette":[]}) })</script>
    <link href="sesion_03_files/panelset/panelset.css" rel="stylesheet" />
    <script src="sesion_03_files/panelset/panelset.js"></script>
    <script src="sesion_03_files/clipboard/clipboard.min.js"></script>
    <link href="sesion_03_files/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="sesion_03_files/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-clipboard\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
    <link href="sesion_03_files/font-awesome/css/all.css" rel="stylesheet" />
    <link href="sesion_03_files/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link href="sesion_03_files/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <script src="sesion_03_files/xaringanExtra-progressBar/progress-bar.js"></script>
    <meta name="github-repo" content="healthinnovation/curso-introduccion-r-tidyverse"/>
    <meta name="twitter:title" content="Introducción a R y Tidyverse: Sesión 03"/>
    <meta name="twitter:description" content="Curso de Introducción a R y Tidyverse: Sesión 03"/>
    <meta name="twitter:url" content="https://healthinnovation.github.io/curso-introduccion-r-tidyverse/sesion_03/#1"/>
    <meta name="twitter:image" content="https://healthinnovation.github.io/xaringan-innovar/img/cover-sesion03.png"/>
    <meta name="twitter:image:alt" content="Cover de la Sesión 03 del curso de Introducción a R y Tidyverse"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:creator" content="@innovalab_imt"/>
    <meta name="twitter:site" content="@innovalab_imt"/>
    <meta property="og:title" content="Introducción a R y Tidyverse: Sesión 03"/>
    <meta property="og:description" content="Curso de Introducción a R y Tidyverse: Sesión 03"/>
    <meta property="og:url" content="https://healthinnovation.github.io/curso-introduccion-r-tidyverse/sesion_03/#1"/>
    <meta property="og:image" content="https://healthinnovation.github.io/xaringan-innovar/img/cover-sesion03.png"/>
    <meta property="og:image:alt" content="Cover de la Sesión 03 del curso de Introducción a R y Tidyverse"/>
    <meta property="og:type" content="website"/>
    <meta property="og:locale" content="en_US"/>
    <meta property="article:author" content="Laboratorio de Innovación en Salud"/>
    <link href="sesion_03_files/countdown/countdown.css" rel="stylesheet" />
    <script src="sesion_03_files/countdown/countdown.js"></script>
    <link href="sesion_03_files/font-awesome-animation/font-awesome-animation-emi.css" rel="stylesheet" />
    <script src="sesion_03_files/fontawesome/js/fontawesome-all.min.js"></script>
    <link rel="stylesheet" href="xaringan-lis.css" type="text/css" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
















<div>
<style type="text/css">.xaringan-extra-logo {
width: 100px;
height: 116px;
z-index: 0;
background-image: url(img/InnovaLab_logo_blue.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:1em;right:1em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('div')
          logo.classList = 'xaringan-extra-logo'
          logo.href = null
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>



<style>.xe__progress-bar__container {
  bottom:0;
  opacity: 1;
  position:absolute;
  right:0;
  left: 0;
}
.xe__progress-bar {
  height: 0.25em;
  background-color: #0051BA;
  width: calc(var(--slide-current) / var(--slide-total) * 100%);
}
.remark-visible .xe__progress-bar {
  animation: xe__progress-bar__wipe 200ms forwards;
  animation-timing-function: cubic-bezier(.86,0,.07,1);
}
@keyframes xe__progress-bar__wipe {
  0% { width: calc(var(--slide-previous) / var(--slide-total) * 100%); }
  100% { width: calc(var(--slide-current) / var(--slide-total) * 100%); }
}</style>




&lt;br&gt;
&lt;br&gt;

# Introducción a R y Tidyverse

## Sesión 03

### Laboratorio de Innovación en Salud  

### 2022-04-02

&lt;br&gt;

[<svg aria-hidden="true" role="img" viewBox="0 0 496 512" style="height:1em;width:0.97em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> @healthinnovation](https://github.com/healthinnovation)  
[<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> @innovalab_imt](https://twitter.com/innovalab_imt)  
[<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg> innovalab.info](https://www.innovalab.info/)  


---
## Contenidos

.line-space3-0[.font120[
- Reconocimiento de variables (función glimpse)
- Anidación de funciones con pipe (%&gt;%)
- Cálculo de variables (introducción a mutate)
- Contabilización y ordenamiento en base a variables (uso de count y arrange).
- Explicación de tidy data 
- Modificación a la estructura de los datos mediante pivot longer y wider 
]]

---
class: center, middle, inverse

# Exploración competencial

---

## Función Glimpse 

.panelset[
.panel[.panel-name[¿Para qué sirve?]
.pull-left[.line-space2-0[.font120[
- Versión transpuesta de print
- Ayuda a visualizar la mayor cantidad de datos de muchas columnas.
- Muestra el nombre de la variable junto con una designación de tipo de variable.
]]]

.pull-right[
&lt;br&gt;
&lt;span style="background-color: #eeff41;
             padding: 20px 250px 15px 10px"&gt;**Mediante la función:**&lt;/span&gt;


```r
glimpse()
```

**Recordar importar el paquete `tidyverse`**
.scroll-output200[

```r
library(tidyverse)
```

```
## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──
```

```
## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
## ✓ tibble  3.1.6     ✓ dplyr   1.0.8
## ✓ tidyr   1.2.0     ✓ stringr 1.4.0
## ✓ readr   2.1.2     ✓ forcats 0.5.1
```

```
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x tidyr::extract()   masks magrittr::extract()
## x dplyr::filter()    masks stats::filter()
## x dplyr::lag()       masks stats::lag()
## x purrr::set_names() masks magrittr::set_names()
```
]]]

.panel[.panel-name[Ejemplo]

.pull-left[
Así habitualmente observamos la data:
.scroll-output350[

```r
nycflights13::flights
```

```
## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515
##  2  2013     1     1      533            529
##  3  2013     1     1      542            540
##  4  2013     1     1      544            545
##  5  2013     1     1      554            600
##  6  2013     1     1      554            558
##  7  2013     1     1      555            600
##  8  2013     1     1      557            600
##  9  2013     1     1      557            600
## 10  2013     1     1      558            600
## # … with 336,766 more rows, and 14 more
## #   variables: dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;
```
]]

.pull-right[
Con `glimpse()`, podrías tener un vistazo rápido de la estructura de los datos:

.scroll-output325[

```r
glimpse(nycflights13::flights)
```

```
## Rows: 336,776
## Columns: 19
## $ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2…
## $ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, 558, …
## $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, 600, …
## $ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1…
## $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753, 849,…
## $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745, 851,…
## $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, 7, -1…
## $ carrier        &lt;chr&gt; "UA", "UA", "AA", "B6", "DL", "UA", "B6", "EV", "B6", "…
## $ flight         &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 301, 4…
## $ tailnum        &lt;chr&gt; "N14228", "N24211", "N619AA", "N804JB", "N668DN", "N394…
## $ origin         &lt;chr&gt; "EWR", "LGA", "JFK", "JFK", "LGA", "EWR", "EWR", "LGA",…
## $ dest           &lt;chr&gt; "IAH", "IAH", "MIA", "BQN", "ATL", "ORD", "FLL", "IAD",…
## $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 149, 1…
## $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, 733, …
## $ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6…
## $ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0…
## $ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 0…
```
]]]

.panel[.panel-name[Glimpse]

Generalmente la vista de `glimpse()` es suficientemente ordenada para poder observar la estructura de la data sin problemas. Pero también se puede usar el argumento `width` para poder especificar ello.

.scroll-output325[

```r
glimpse(nycflights13::flights, width = 90)
```

```
## Rows: 336,776
## Columns: 19
## $ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013,…
## $ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, 558, 558, 558, …
## $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, 600, 600, 600, …
## $ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1, 0, -1, 0…
## $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753, 849, 853, 924,…
## $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745, 851, 856, 917,…
## $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, 7, -14, 31, -4,…
## $ carrier        &lt;chr&gt; "UA", "UA", "AA", "B6", "DL", "UA", "B6", "EV", "B6", "AA", "B6",…
## $ flight         &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 301, 49, 71, 194…
## $ tailnum        &lt;chr&gt; "N14228", "N24211", "N619AA", "N804JB", "N668DN", "N39463", "N516…
## $ origin         &lt;chr&gt; "EWR", "LGA", "JFK", "JFK", "LGA", "EWR", "EWR", "LGA", "JFK", "L…
## $ dest           &lt;chr&gt; "IAH", "IAH", "MIA", "BQN", "ATL", "ORD", "FLL", "IAD", "MCO", "O…
## $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 149, 158, 345, 3…
## $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, 733, 1028, 1005…
## $ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6, 6, 6, 6,…
## $ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0, 0, 0, 0,…
## $ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2…
```
]]]

---

## Operador Pipe `%&gt;%`

.pull-left[
**Queremos aplicar más de una función:**
El uso de funciones de forma anidada puede resultar ilegible o difícil de comprender.


```r
tabla(formato(coeficiente(data)))
```

El operador `%&gt;%` nos permite escribir una secuencia de operaciones de izquierda a derecha:


```r
coeficiente(data) %&gt;% formato() %&gt;% tabla()
```

**O mejor aún:**


```r
coeficiente(data) %&gt;% 
  formato() %&gt;% 
  tabla()
```
]

.pull-right[.font120[
&lt;br&gt;
Útil para concatenar múltiples operaciones en dplyr 

&lt;br&gt;
&lt;span style="background-color: #eeff41;
             padding: 20px 250px 15px 10px"&gt;**Atajo de Teclado**&lt;/span&gt;

&lt;br&gt;

&lt;img src="img/atajo_pipe.svg" width="100%" /&gt;
]]


---

## Función `mutate()`


.pull-left[.line-space2-0[.font110[ 
Con `mutate()` podemos realizar modificaciones en las variables.  Por ej. sumar variables, o modificarlas de alguna manera (transformar a porcentaje, multiplicarlas por alguna constante, etc.). Estas modificaciones pueden realizarse:

- Creando una nueva variable a partir de otras ya existentes.
- Modificar una variable existente en la misma variable.

]]]

.pull-right[.font110[
&lt;span style="background-color: #eeff41;
             padding: 20px 250px 15px 10px"&gt;**Ejemplo:**&lt;/span&gt;


```r
library(tidyverse)

df %&gt;% 
  mutate(
    New_var = var*2
  )
```

**Explicación:**

En una data llamada `df` se estaría aplicando la función `mutate` creando una variable llamada `New_var` a partir de otra variable llamada `var` que está siendo multiplicada por 2.

]]

---
## Uso práctico de `mutate()`


.panelset[
.panel[.panel-name[Reconocimiento de BD]

Para esta ejemplificación usaremos la base de datos del ECA  sobre la [erradicación de la infección por *Helicobácter Pylori*](https://www.nature.com/articles/s41598-018-27482-2) explicado en la [sesión 02](https://healthinnovation.github.io/curso-introduccion-r-tidyverse/sesion_02/#14).

.pull-left[
.scroll-output350[

```r
trial_data &lt;- readxl::read_excel("data/researchdata.xlsx")
trial_data
```

```
## # A tibble: 400 × 10
##    `Patient number` `Baseline 13C-UBT`
##               &lt;dbl&gt; &lt;chr&gt;             
##  1                1 Positive          
##  2                2 Positive          
##  3                3 Positive          
##  4                4 Positive          
##  5                5 Positive          
##  6                6 Positive          
##  7                7 Positive          
##  8                8 Positive          
##  9                9 Positive          
## 10               10 Positive          
## # … with 390 more rows, and 8 more
## #   variables: `Randomized group` &lt;chr&gt;,
## #   `Follow-up13C-UBT (4 weeks after therapy)` &lt;chr&gt;,
## #   `adverse drug reactions` &lt;chr&gt;,
## #   `adverse drug reactions  content` &lt;chr&gt;,
## #   `Adverse drug reaction classified` &lt;chr&gt;,
## #   `Complete the study` &lt;chr&gt;, …
```
]]

.pull-right[
.scroll-output350[

```r
glimpse(trial_data)
```

```
## Rows: 400
## Columns: 10
## $ `Patient number`                           &lt;dbl&gt; 1, 2, 3, 4, 5, 6,…
## $ `Baseline 13C-UBT`                         &lt;chr&gt; "Positive", "Posi…
## $ `Randomized group`                         &lt;chr&gt; "group B", "group…
## $ `Follow-up13C-UBT (4 weeks after therapy)` &lt;chr&gt; "Negative", "Nega…
## $ `adverse drug reactions`                   &lt;chr&gt; "No", "Yes", "No"…
## $ `adverse drug reactions  content`          &lt;chr&gt; "NA", "Fatigue", …
## $ `Adverse drug reaction classified`         &lt;chr&gt; "NA", "Mild", "NA…
## $ `Complete the study`                       &lt;chr&gt; "Yes", "Yes", "Ye…
## $ `Uncompleted Reason`                       &lt;chr&gt; "NA", "NA", "NA",…
## $ `per protocol analysis`                    &lt;chr&gt; "Yes", "Yes", "Ye…
```
]]
]

.panel[.panel-name[Janitor]

En algunas ocasiones las base de datos contienen nombres de variables muy largas o que incluso pueden contener espacios o símbolos. Una forma sencilla de solucionar ello es mediante el uso de la función `clean_names()` del paquete `janitor`.

.scroll-output300[

```r
trial_data &lt;- trial_data %&gt;% 
  janitor::clean_names() 
trial_data
```

```
## # A tibble: 400 × 10
##    patient_number baseline_13c_ubt randomized_group follow_up13c_ubt_4_w… adverse_drug_re…
##             &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;                 &lt;chr&gt;           
##  1              1 Positive         group B          Negative              No              
##  2              2 Positive         group A          Negative              Yes             
##  3              3 Positive         group B          Negative              No              
##  4              4 Positive         group A          Positive              Yes             
##  5              5 Positive         group A          Negative              Yes             
##  6              6 Positive         group A          Negative              No              
##  7              7 Positive         group B          Negative              No              
##  8              8 Positive         group A          Negative              No              
##  9              9 Positive         group A          Negative              No              
## 10             10 Positive         group A          NA                    NA              
## # … with 390 more rows, and 5 more variables: adverse_drug_reactions_content &lt;chr&gt;,
## #   adverse_drug_reaction_classified &lt;chr&gt;, complete_the_study &lt;chr&gt;,
## #   uncompleted_reason &lt;chr&gt;, per_protocol_analysis &lt;chr&gt;
```
]]

.panel[.panel-name[Rename]

A pesar de que `janitor::clean_names()` nos proporciona una gran solución para el formateo de nombres de variables que tienen espacios y/o símbolos, a veces podría ser necesario modificar específicamente el nombre de algunas variables. Para ello usaremos la función `rename` de la siguiente manera:

.scroll-output300[

```r
trial_data &lt;- trial_data %&gt;% 
  rename(
*   follow_4_weeks = follow_up13c_ubt_4_weeks_after_therapy
  )
trial_data
```

```
## # A tibble: 400 × 10
*##    patient_number baseline_13c_ubt randomized_group follow_4_weeks adverse_drug_reactions
##             &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;          &lt;chr&gt;                 
##  1              1 Positive         group B          Negative       No                    
##  2              2 Positive         group A          Negative       Yes                   
##  3              3 Positive         group B          Negative       No                    
##  4              4 Positive         group A          Positive       Yes                   
##  5              5 Positive         group A          Negative       Yes                   
##  6              6 Positive         group A          Negative       No                    
##  7              7 Positive         group B          Negative       No                    
##  8              8 Positive         group A          Negative       No                    
##  9              9 Positive         group A          Negative       No                    
## 10             10 Positive         group A          NA             NA                    
## # … with 390 more rows, and 5 more variables: adverse_drug_reactions_content &lt;chr&gt;,
## #   adverse_drug_reaction_classified &lt;chr&gt;, complete_the_study &lt;chr&gt;,
## #   uncompleted_reason &lt;chr&gt;, per_protocol_analysis &lt;chr&gt;
```
]]

.panel[.panel-name[Mutate I]

.pull-left[.line-space2-0[
Una de las primeras cosas que podemos hacer con `mutate` durante el primer contacto con la data que trabajemos es:

- Configurar variables `ID` como **texto** (`character`).
- Configurar variables como **factores**.
- Configurar respuestas `NA` en caso tengan alguna otra codificación.
]]

.pull-right[
1. Configurar la variable `ID`

.scroll-output325[.code80[

```r
trial_data %&gt;% 
  mutate(
    patient_number = as.character(patient_number)
  )
```

```
## # A tibble: 400 × 10
##    patient_number baseline_13c_ubt
##    &lt;chr&gt;          &lt;chr&gt;           
##  1 1              Positive        
##  2 2              Positive        
##  3 3              Positive        
##  4 4              Positive        
##  5 5              Positive        
##  6 6              Positive        
##  7 7              Positive        
##  8 8              Positive        
##  9 9              Positive        
## 10 10             Positive        
## # … with 390 more rows, and 8 more
## #   variables: randomized_group &lt;chr&gt;,
## #   follow_4_weeks &lt;chr&gt;,
## #   adverse_drug_reactions &lt;chr&gt;,
## #   adverse_drug_reactions_content &lt;chr&gt;,
## #   adverse_drug_reaction_classified &lt;chr&gt;,
## #   complete_the_study &lt;chr&gt;, …
```
]]
]]

.panel[.panel-name[Mutate II]
.pull-left[
&lt;ol start="2"&gt;
  &lt;li&gt;Configurar &lt;strong&gt;factores&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;

.scroll-output325[.code80[

```r
trial_data %&gt;% 
  mutate(
*   randomized_group = factor(randomized_group),
*   complete_the_study = factor(complete_the_study)
  )
```

```
## # A tibble: 400 × 10
##    patient_number baseline_13c_ubt
##             &lt;dbl&gt; &lt;chr&gt;           
##  1              1 Positive        
##  2              2 Positive        
##  3              3 Positive        
##  4              4 Positive        
##  5              5 Positive        
##  6              6 Positive        
##  7              7 Positive        
##  8              8 Positive        
##  9              9 Positive        
## 10             10 Positive        
## # … with 390 more rows, and 8 more
*## #   variables: randomized_group &lt;fct&gt;,
## #   follow_4_weeks &lt;chr&gt;,
## #   adverse_drug_reactions &lt;chr&gt;,
## #   adverse_drug_reactions_content &lt;chr&gt;,
## #   adverse_drug_reaction_classified &lt;chr&gt;,
*## #   complete_the_study &lt;fct&gt;, …
```
]]
]

.pull-right[
&lt;ol start="3"&gt;
  &lt;li&gt;Configurar respuestas &lt;code&gt;NA&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

Para reemplazar respuestas dependiendo de una condición en particular se puede utilizar la función `case_when()` dentro de un `mutate()`

.code80[

```r
trial_data %&gt;% 
  mutate(
    Var = case_when(
      Var == "Text" ~ "New_Text", 
      TRUE ~ Var
    )
  )
```
]
De esta manera en la variable `Var` se reemplazará todos los casos que registren el dato de **Text** por **New_Text**. 
]

]]

---

## Uso de `count`

.line-space1-5[
La función `count` es bastante sencilla y poderosa a la vez. Permite obtener una tabla en formato `tibble` que representará las frecuencias (cantidades `n`) de una o múltiples variables en específico.
]


```r
trial_data %&gt;% 
  count(adverse_drug_reactions)
```

```
## # A tibble: 4 × 2
##   adverse_drug_reactions     n
##   &lt;chr&gt;                  &lt;int&gt;
## 1 NA                        10
## 2 No                       295
## 3 Yes                       94
## 4 &lt;NA&gt;                       1
```

.line-space1-5[
La tabla generada muestra que cantidad de personas han tenido reacciones adversas a los medicamentos ya sea en el Grupo A o B. Sin embargo, también se aprecia que hay 2 respuestas que indican la presencia de datos vacíos: **NA** y **&amp;lt;NA&amp;gt;**. El primero está codificado directamente como texto (`character`) y sel segudo es un `NA` real, es decir que comunica la ausencia de un dato.
]

---
## Uso de `mutate()` y `case_when()`

.panelset[
.panel[.panel-name[Explicación previa del NA]
.line-space1-5[
Al importar las bases de datos dentro de R, la gran mayoría de funciones (como `read_excel()`) interpretarán los valors en blanco o celdas vacías como reales `NA`. Sin embargo si en las celdas se ha llenado explícitamente el texto **NA** o se ha usado alguna codificación diferente, el valor de `NA` no se introducirá automáticamente y habrá que indicarlo como tal (`case_when()`).
]

.pull-left[
&lt;img src="img/view_excel_na.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.pull-right[

```r
trial_data %&gt;% 
  count(adverse_drug_reactions)
```

```
## # A tibble: 4 × 2
##   adverse_drug_reactions     n
##   &lt;chr&gt;                  &lt;int&gt;
*## 1 NA                        10
## 2 No                       295
## 3 Yes                       94
*## 4 &lt;NA&gt;                       1
```
]]

.panel[.panel-name[Uso de case_when()]

La función `case_when()` tiene una aplicación directa y perfecta para estos fines, en el que recodificaremos el **NA** introducido como texto a un `NA` real que sea reconocido como tal. El mismo procedimiento se utilizaría si los valores faltantes o perdidos se hubieran codificado de otra forma (ej. `777` o `999`).

.pull-left[
Recordar que con **pipe** (` %&gt;% `) podemos anidar muchas funciones en un solo bloque:


```r
trial_data %&gt;%
  mutate(
    adverse_drug_reactions = case_when(
*     adverse_drug_reactions == "NA" ~ NA_character_,
      TRUE ~ adverse_drug_reactions
    )
  ) %&gt;% 
  count()
```
]

.pull-right[

El código `TRUE ~ adverse_drug_reactions` significa que **todos los demás casos** mantendrán el valor original que el de la variable.


```
## # A tibble: 3 × 2
##   adverse_drug_reactions     n
##   &lt;chr&gt;                  &lt;int&gt;
## 1 No                       295
## 2 Yes                       94
*## 3 &lt;NA&gt;                      11
```
]]

.panel[.panel-name[Advertencia]

La función `case_when` requiere respetar de forma estricta el tipo de vector utilizado. Es decir que si se le pide recodificar una variable a número, y dentro de esa variable continúan habiendo textos, habrá un problema de **no-coerción**. Es por ese motivo que en el anterior ejemplo se usa `NA_character` en vez de únicamente `NA`, ya que este elemento como tal en realidad es de tipo lógico.


```r
typeof(NA)
```

```
## [1] "logical"
```

```r
typeof(NA_character_)
```

```
## [1] "character"
```

```r
typeof(NA_real_)
```

```
## [1] "double"
```

]]

---
## Más sobre `case_when()`

Anteriormente vimos como usar la función `case_when` para recategorizar/recodificar variables en base a una condición de igualdad (`==`). Sin embargo, no es la única manera. También se puede recategorizar en base a múltiples condiciones, como `%in%` (comparar con múltiples valores a la vez), `&gt;`, `&gt;=`, `&lt;` y `&lt;=`, en conjunto con `&amp;` y `|`.

.pull-left[

Para ejemplificar esto haremos una recategorización de la base `nycflights13::flights`:

.scroll-output225[

```r
nycflights13::flights %&gt;% 
  count(year, month)
```

```
## # A tibble: 12 × 3
##     year month     n
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1 27004
##  2  2013     2 24951
##  3  2013     3 28834
##  4  2013     4 28330
##  5  2013     5 28796
##  6  2013     6 28243
##  7  2013     7 29425
##  8  2013     8 29327
##  9  2013     9 27574
## 10  2013    10 28889
## 11  2013    11 27268
## 12  2013    12 28135
```
]]

.pull-right[
Consideraremos del mes 1 hasta el 6 como **2013-I** y a partir del mes 7, como **2013-II**. 

.scroll-output250[

```r
nycflights13::flights %&gt;% 
  mutate(
    year = case_when(
      month %in% 1:6 ~ "2013-I",
      TRUE ~ "2013-II"
    )
  ) %&gt;% 
  count(year)
```

```
## # A tibble: 2 × 2
##   year         n
##   &lt;chr&gt;    &lt;int&gt;
## 1 2013-I  166158
## 2 2013-II 170618
```
]]

---
## Más sobre `case_when()`

Ya que la variable `month` es de tipo `integer` (**numérica**) tenemos más formas alternativas de conseguir exactamente el mismo resultado mostrado anteriormente.

.pull-left[

En variables numéricas, podemos directamente usar `&lt;=` en las condiciones.


```r
nycflights13::flights %&gt;% 
  mutate(
    year = case_when(
      month &lt;= 6 ~ "2013-I",
      month &gt; 6 ~ "2013-II"
    )
  ) %&gt;% 
  count(year) 
```

```
## # A tibble: 2 × 2
##   year         n
##   &lt;chr&gt;    &lt;int&gt;
## 1 2013-I  166158
## 2 2013-II 170618
```
]

.pull-right[

O directamente usar `TRUE ~ "Condicion`, para *todos los demás casos*.


```r
nycflights13::flights %&gt;% 
  mutate(
    year = case_when(
      month &lt;= 6 ~ "2013-I",
      TRUE ~ "2013-II"
    )
  ) %&gt;% 
  count(year) 
```

```
## # A tibble: 2 × 2
##   year         n
##   &lt;chr&gt;    &lt;int&gt;
## 1 2013-I  166158
## 2 2013-II 170618
```
]

---
## Más usos de `count()` y `arrange()`

.panelset[
.panel[.panel-name[Intro]

Ya hemos visto que `count()` es sumamente útil. Además, basta con agregar más variables dentro de sus argumentos, para que estos automáticamente ingresen a generar una tabla de frecuencias. Sin embargo, a veces puede ser necesario ordenar esos resultados, para ello usaremos `arrange()`.

.pull-left[

```r
trial_data &lt;- trial_data %&gt;% 
  mutate(
    follow_4_weeks = case_when(
      follow_4_weeks == "NA" ~ NA_character_,
      TRUE ~ follow_4_weeks
    ),
    adverse_drug_reactions = case_when(
      adverse_drug_reactions == "NA" ~ NA_character_,
      TRUE ~ adverse_drug_reactions
    )
  )
```
]

.pull-right[
.scroll-output300[

```r
trial_data %&gt;% 
  count(randomized_group, 
        follow_4_weeks,
        adverse_drug_reactions)
```

```
## # A tibble: 13 × 4
##    randomized_group follow_4_weeks adverse_drug_reactions     n
##    &lt;chr&gt;            &lt;chr&gt;          &lt;chr&gt;                  &lt;int&gt;
##  1 group A          Negative       No                       124
##  2 group A          Negative       Yes                       31
##  3 group A          Positive       No                        27
##  4 group A          Positive       Yes                       14
##  5 group A          &lt;NA&gt;           &lt;NA&gt;                       4
##  6 group B          Negative       No                       114
##  7 group B          Negative       Yes                       41
##  8 group B          Negative       &lt;NA&gt;                       4
##  9 group B          Positive       No                        25
## 10 group B          Positive       Yes                        8
## 11 group B          Positive       &lt;NA&gt;                       2
## 12 group B          &lt;NA&gt;           No                         5
## 13 group B          &lt;NA&gt;           &lt;NA&gt;                       1
```
]]
]

.panel[.panel-name[arrange()]

La función `arrange()` permitirá ordenar un objeto en base a una o múltiples variables. En caso se ejecute sobre una variable numérica, se ordenará de menor a mayor por defecto, y en caso se ejecute sobre una variable texto (`character`) se ordenará de forma alfabética, tal y como ya lo hace `count()` por defecto.


.pull-left[
Si se desea invertir el ordenamiento, se puede utilizar la función `desc()` dentro de `arrange()`.


&lt;code class ='r hljs remark-code'&gt;trial_data %&gt;% &lt;br&gt;&amp;nbsp;&amp;nbsp;count(randomized_group, &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;follow_4_weeks,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;adverse_drug_reactions) %&gt;% &lt;br&gt;&amp;nbsp;&amp;nbsp;arrange(randomized_group, &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style="background-color:#ffff7f"&gt;&lt;span style="color:red"&gt;desc&lt;/span&gt;(follow_4_weeks)&lt;/span&gt;)&lt;/code&gt;
]

.pull-right[
.scroll-output275[

```
## # A tibble: 13 × 4
##    randomized_group follow_4_weeks adverse_drug_reactions     n
##    &lt;chr&gt;            &lt;chr&gt;          &lt;chr&gt;                  &lt;int&gt;
##  1 group A          Positive       No                        27
##  2 group A          Positive       Yes                       14
##  3 group A          Negative       No                       124
##  4 group A          Negative       Yes                       31
##  5 group A          &lt;NA&gt;           &lt;NA&gt;                       4
##  6 group B          Positive       No                        25
##  7 group B          Positive       Yes                        8
##  8 group B          Positive       &lt;NA&gt;                       2
##  9 group B          Negative       No                       114
## 10 group B          Negative       Yes                       41
## 11 group B          Negative       &lt;NA&gt;                       4
## 12 group B          &lt;NA&gt;           No                         5
## 13 group B          &lt;NA&gt;           &lt;NA&gt;                       1
```
]]
]]

---



count: false
 
## Uso de slice_max() 
.line-space1-7[.font110[Anteriormente conocido como `top_n()`, la función `slice_max()`, permite seleccionar cuantos casos (filas) se específique en base a una variable numérica.]]
.panel1-slice_max_1-user[

```r
*trial_data
```
]
 
.panel2-slice_max_1-user[

```
## # A tibble: 400 × 10
##    patient_number baseline_13c_ubt randomized_group
##             &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;           
##  1              1 Positive         group B         
##  2              2 Positive         group A         
##  3              3 Positive         group B         
##  4              4 Positive         group A         
##  5              5 Positive         group A         
##  6              6 Positive         group A         
##  7              7 Positive         group B         
##  8              8 Positive         group A         
##  9              9 Positive         group A         
## 10             10 Positive         group A         
## # … with 390 more rows, and 7 more variables:
## #   follow_4_weeks &lt;chr&gt;, adverse_drug_reactions &lt;chr&gt;,
## #   adverse_drug_reactions_content &lt;chr&gt;,
## #   adverse_drug_reaction_classified &lt;chr&gt;,
## #   complete_the_study &lt;chr&gt;, uncompleted_reason &lt;chr&gt;,
## #   per_protocol_analysis &lt;chr&gt;
```
]

---
count: false
 
## Uso de slice_max() 
.line-space1-7[.font110[Anteriormente conocido como `top_n()`, la función `slice_max()`, permite seleccionar cuantos casos (filas) se específique en base a una variable numérica.]]
.panel1-slice_max_1-user[

```r
trial_data %&gt;%
* count(randomized_group,
*       follow_4_weeks)
```
]
 
.panel2-slice_max_1-user[

```
## # A tibble: 6 × 3
##   randomized_group follow_4_weeks     n
##   &lt;chr&gt;            &lt;chr&gt;          &lt;int&gt;
## 1 group A          Negative         155
## 2 group A          Positive          41
## 3 group A          &lt;NA&gt;               4
## 4 group B          Negative         159
## 5 group B          Positive          35
## 6 group B          &lt;NA&gt;               6
```
]

---
count: false
 
## Uso de slice_max() 
.line-space1-7[.font110[Anteriormente conocido como `top_n()`, la función `slice_max()`, permite seleccionar cuantos casos (filas) se específique en base a una variable numérica.]]
.panel1-slice_max_1-user[

```r
trial_data %&gt;%
  count(randomized_group,
        follow_4_weeks) %&gt;%
* slice_max(order_by = n,
*           n = 2)
```
]
 
.panel2-slice_max_1-user[

```
## # A tibble: 2 × 3
##   randomized_group follow_4_weeks     n
##   &lt;chr&gt;            &lt;chr&gt;          &lt;int&gt;
## 1 group B          Negative         159
## 2 group A          Negative         155
```
]

&lt;style&gt;
.panel1-slice_max_1-user {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-slice_max_1-user {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-slice_max_1-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





&lt;style type="text/css"&gt;
.panel2-slice_max_1-user {
    height: 380px;
    overflow-y: auto !important;
}
&lt;/style&gt;

---
## ¡Hazlo tú mismo!

.line-space2-0[.font120[
1. Generar una tabla de frecuencias para conocer cuantos de los que completaron el estudio, presentaron reacciones adversas al tratamiento
2. Complementar la tabla del anterior punto agregando la variable del grupo de tratamiento al que pertenece.
]]

<div class="countdown" id="timer_6248bd01" style="right:0;bottom:0;margin:1em;font-size:4em;" data-warnwhen="30">
<code class="countdown-time"><span class="countdown-digits minutes">08</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
---
## Introducción a tidydata 

.font80[
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="img/tidydata_7.jpg" alt="Tidy data for Efficiency, Reproducibility, and Collaboration" width="75%" /&gt;
&lt;p class="caption"&gt;Julie Lowndes y Allison Horst, 2020, Tidy data for Efficiency, Reproducibility, and Collaboration&lt;/p&gt;
&lt;/div&gt;
]

---
## Introducción a tidydata 

.left-column[.line-space1-5[
Tener datos ordenados (**tidydata**) significa tener una BD con estructuras adecuadas, donde cada registro representa una fila, cada variable representa una columna y cada celda contiene una simple medida ([**Hadley Wickham,2014**](https://www.jstatsoft.org/article/view/v059i10)).
]]

.right-column[
.font80[
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="img/tidydata_1.jpg" alt="En tidydata, cada variable es una columna; cada observación, una fila; y cada celda es una medición única." width="95%" /&gt;
&lt;p class="caption"&gt;Julie Lowndes y Allison Horst, 2020, Tidy data for Efficiency, Reproducibility, and Collaboration&lt;/p&gt;
&lt;/div&gt;
]]

---
## Uso de pivot_longer() y pivot_wider()

.panelset[
.panel[.panel-name[Intro]

.left-column[.line-space1-5[
Para este ejemplo usaremos una base de datos que contiene casos de personas fallecidas a causa del coranovirus a nivel de país, este dataset está alojada en el siguiente repositorio de GitHub ([click aquí](https://github.com/CSSEGISandData/COVID-19)).
]]

.right-column[.font80[
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="img/github_covid_1.png" alt="Repositorio github de personas fallecidas por Coronavirus a nivel global" width="95%" /&gt;
&lt;p class="caption"&gt;Personas fallecidas por Coronavirus a nivel global&lt;/p&gt;
&lt;/div&gt;
]]
]

.panel[.panel-name[Importación]

La función `read_csv` del paquete `readr` (se carga automáticamente cuando se realiza `library(tidyverse)`), permite importar archivos `csv` (data) incluso cuando el archivo está en una web.

.scroll-output300[

```r
covid19 &lt;- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv")
covid19
```

```
## # A tibble: 284 × 805
##    `Province/State`  `Country/Region`   Lat   Long `1/22/20` `1/23/20` `1/24/20` `1/25/20`
##    &lt;chr&gt;             &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 &lt;NA&gt;              Afghanistan       33.9  67.7          0         0         0         0
##  2 &lt;NA&gt;              Albania           41.2  20.2          0         0         0         0
##  3 &lt;NA&gt;              Algeria           28.0   1.66         0         0         0         0
##  4 &lt;NA&gt;              Andorra           42.5   1.52         0         0         0         0
##  5 &lt;NA&gt;              Angola           -11.2  17.9          0         0         0         0
##  6 &lt;NA&gt;              Antarctica       -71.9  23.3          0         0         0         0
##  7 &lt;NA&gt;              Antigua and Bar…  17.1 -61.8          0         0         0         0
##  8 &lt;NA&gt;              Argentina        -38.4 -63.6          0         0         0         0
##  9 &lt;NA&gt;              Armenia           40.1  45.0          0         0         0         0
## 10 Australian Capit… Australia        -35.5 149.           0         0         0         0
## # … with 274 more rows, and 797 more variables: `1/26/20` &lt;dbl&gt;, `1/27/20` &lt;dbl&gt;,
## #   `1/28/20` &lt;dbl&gt;, `1/29/20` &lt;dbl&gt;, `1/30/20` &lt;dbl&gt;, `1/31/20` &lt;dbl&gt;, `2/1/20` &lt;dbl&gt;,
## #   `2/2/20` &lt;dbl&gt;, `2/3/20` &lt;dbl&gt;, `2/4/20` &lt;dbl&gt;, `2/5/20` &lt;dbl&gt;, `2/6/20` &lt;dbl&gt;,
## #   `2/7/20` &lt;dbl&gt;, `2/8/20` &lt;dbl&gt;, `2/9/20` &lt;dbl&gt;, `2/10/20` &lt;dbl&gt;, `2/11/20` &lt;dbl&gt;,
## #   `2/12/20` &lt;dbl&gt;, `2/13/20` &lt;dbl&gt;, `2/14/20` &lt;dbl&gt;, `2/15/20` &lt;dbl&gt;, `2/16/20` &lt;dbl&gt;,
## #   `2/17/20` &lt;dbl&gt;, `2/18/20` &lt;dbl&gt;, `2/19/20` &lt;dbl&gt;, `2/20/20` &lt;dbl&gt;, `2/21/20` &lt;dbl&gt;,
## #   `2/22/20` &lt;dbl&gt;, `2/23/20` &lt;dbl&gt;, `2/24/20` &lt;dbl&gt;, `2/25/20` &lt;dbl&gt;, …
```
]]

.panel[.panel-name[¿Pivot?]

.pull-left[.font80[
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="img/pivot_longer_wider.png" alt="Infografía de pivot realizado por Dr. Peter D.R. Higgins" width="75%" /&gt;
&lt;p class="caption"&gt;Infografía de pivot realizado por Dr. Peter D.R. Higgins&lt;/p&gt;
&lt;/div&gt;

]]

.pull-right[.line-space1-5[.font110[
Tenemos un conjunto de datos donde cada una de las fechas de fallecimiento por **Covid-19** se encuentran almacenadas como columnas. 

Sin embargo, esta forma de organizar la información podría generar dificultades al momento de pre-procesar la información o realizar algún tipo de análisis. Tener todas las fechas y casos de muerte por COVID-19 en 2 columnas (`fecha` y `fallecidos`), podría ayudar a este proceso. 
]]]
]

.panel[.panel-name[Pivotear]

.left-column[.line-space2-2[.font110[
Así, dependiendo de el formato inicial de los datos, tendremos que **pivotear** hacia la derecha (`wider`) o hacia abajo (`longer`).
]]]

.right-column[

.pull-left[.font80[
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="img/tidyr-pivot_wider_longer.gif" alt="Animación del uso de pivot_longer y pivot_wider" width="85%" /&gt;
&lt;p class="caption"&gt;Transformación de datos, 2021, Data Analytics Coding Fundamentals&lt;/p&gt;
&lt;/div&gt;
]]

.pull-right[
&lt;br&gt;
&lt;br&gt;
&lt;img src="img/ross-pivot-friends.gif" title="Gif sobre Ross en la serie Friends diciendo Pivot Pivot Pivot, para intentar subir su sillón nuevo a su nuevo departamento" alt="Gif sobre Ross en la serie Friends diciendo Pivot Pivot Pivot, para intentar subir su sillón nuevo a su nuevo departamento" width="100%" style="display: block; margin: auto;" /&gt;
]]]
]

---



count: false
 
## Uso de pivot_longer() 
.line-space1-7[.font110[La función `pivot_longer` permitirá pasar todas las fechas que están a lo largo de las columnas a 2: `fecha` y `fallecidos`.]]
.panel1-pivot_longer_1-user[

```r
*covid19
```
]
 
.panel2-pivot_longer_1-user[

```
## # A tibble: 284 × 805
##    `Province/State`       `Country/Region`   Lat   Long
##    &lt;chr&gt;                  &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt;
##  1 &lt;NA&gt;                   Afghanistan       33.9  67.7 
##  2 &lt;NA&gt;                   Albania           41.2  20.2 
##  3 &lt;NA&gt;                   Algeria           28.0   1.66
##  4 &lt;NA&gt;                   Andorra           42.5   1.52
##  5 &lt;NA&gt;                   Angola           -11.2  17.9 
##  6 &lt;NA&gt;                   Antarctica       -71.9  23.3 
##  7 &lt;NA&gt;                   Antigua and Bar…  17.1 -61.8 
##  8 &lt;NA&gt;                   Argentina        -38.4 -63.6 
##  9 &lt;NA&gt;                   Armenia           40.1  45.0 
## 10 Australian Capital Te… Australia        -35.5 149.  
## # … with 274 more rows, and 801 more variables:
## #   `1/22/20` &lt;dbl&gt;, `1/23/20` &lt;dbl&gt;, `1/24/20` &lt;dbl&gt;,
## #   `1/25/20` &lt;dbl&gt;, `1/26/20` &lt;dbl&gt;, `1/27/20` &lt;dbl&gt;,
## #   `1/28/20` &lt;dbl&gt;, `1/29/20` &lt;dbl&gt;, `1/30/20` &lt;dbl&gt;,
## #   `1/31/20` &lt;dbl&gt;, `2/1/20` &lt;dbl&gt;, `2/2/20` &lt;dbl&gt;,
## #   `2/3/20` &lt;dbl&gt;, `2/4/20` &lt;dbl&gt;, `2/5/20` &lt;dbl&gt;,
## #   `2/6/20` &lt;dbl&gt;, `2/7/20` &lt;dbl&gt;, `2/8/20` &lt;dbl&gt;, …
```
]

---
count: false
 
## Uso de pivot_longer() 
.line-space1-7[.font110[La función `pivot_longer` permitirá pasar todas las fechas que están a lo largo de las columnas a 2: `fecha` y `fallecidos`.]]
.panel1-pivot_longer_1-user[

```r
covid19 %&gt;%
* select(-c(Lat:Long))
```
]
 
.panel2-pivot_longer_1-user[

```
## # A tibble: 284 × 803
##    `Province/State`          `Country/Region` `1/22/20`
##    &lt;chr&gt;                     &lt;chr&gt;                &lt;dbl&gt;
##  1 &lt;NA&gt;                      Afghanistan              0
##  2 &lt;NA&gt;                      Albania                  0
##  3 &lt;NA&gt;                      Algeria                  0
##  4 &lt;NA&gt;                      Andorra                  0
##  5 &lt;NA&gt;                      Angola                   0
##  6 &lt;NA&gt;                      Antarctica               0
##  7 &lt;NA&gt;                      Antigua and Bar…         0
##  8 &lt;NA&gt;                      Argentina                0
##  9 &lt;NA&gt;                      Armenia                  0
## 10 Australian Capital Terri… Australia                0
## # … with 274 more rows, and 800 more variables:
## #   `1/23/20` &lt;dbl&gt;, `1/24/20` &lt;dbl&gt;, `1/25/20` &lt;dbl&gt;,
## #   `1/26/20` &lt;dbl&gt;, `1/27/20` &lt;dbl&gt;, `1/28/20` &lt;dbl&gt;,
## #   `1/29/20` &lt;dbl&gt;, `1/30/20` &lt;dbl&gt;, `1/31/20` &lt;dbl&gt;,
## #   `2/1/20` &lt;dbl&gt;, `2/2/20` &lt;dbl&gt;, `2/3/20` &lt;dbl&gt;,
## #   `2/4/20` &lt;dbl&gt;, `2/5/20` &lt;dbl&gt;, `2/6/20` &lt;dbl&gt;,
## #   `2/7/20` &lt;dbl&gt;, `2/8/20` &lt;dbl&gt;, `2/9/20` &lt;dbl&gt;, …
```
]

---
count: false
 
## Uso de pivot_longer() 
.line-space1-7[.font110[La función `pivot_longer` permitirá pasar todas las fechas que están a lo largo de las columnas a 2: `fecha` y `fallecidos`.]]
.panel1-pivot_longer_1-user[

```r
covid19 %&gt;%
  select(-c(Lat:Long)) %&gt;%
* pivot_longer(
*   cols = -c(`Province/State`:`Country/Region`),
*   names_to = "fecha",
*   values_to = "fallecidos"
* )
```
]
 
.panel2-pivot_longer_1-user[

```
## # A tibble: 227,484 × 4
##    `Province/State` `Country/Region` fecha   fallecidos
##    &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;        &lt;dbl&gt;
##  1 &lt;NA&gt;             Afghanistan      1/22/20          0
##  2 &lt;NA&gt;             Afghanistan      1/23/20          0
##  3 &lt;NA&gt;             Afghanistan      1/24/20          0
##  4 &lt;NA&gt;             Afghanistan      1/25/20          0
##  5 &lt;NA&gt;             Afghanistan      1/26/20          0
##  6 &lt;NA&gt;             Afghanistan      1/27/20          0
##  7 &lt;NA&gt;             Afghanistan      1/28/20          0
##  8 &lt;NA&gt;             Afghanistan      1/29/20          0
##  9 &lt;NA&gt;             Afghanistan      1/30/20          0
## 10 &lt;NA&gt;             Afghanistan      1/31/20          0
## # … with 227,474 more rows
```
]

&lt;style&gt;
.panel1-pivot_longer_1-user {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-pivot_longer_1-user {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-pivot_longer_1-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





&lt;style type="text/css"&gt;
.panel2-pivot_longer_1-user {
    height: 380px;
    overflow-y: auto !important;
}
&lt;/style&gt;

---




count: false
 
## Uso de pivot_wider() 
.line-space1-7[.font110[De forma análoga, la función `pivot_wider()` hará exactamente lo contrario, pasar de una data que se encuentre ordenada (**tidy data**), a una data ancha. Para esta función se tendrá que indicar los argumentos: `names_from` y `values_from`.]]
.panel1-pivot_wider_1-user[

```r
*covid19_tidy
```
]
 
.panel2-pivot_wider_1-user[

```
## # A tibble: 227,484 × 4
##    `Province/State` `Country/Region` fecha   fallecidos
##    &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;        &lt;dbl&gt;
##  1 &lt;NA&gt;             Afghanistan      1/22/20          0
##  2 &lt;NA&gt;             Afghanistan      1/23/20          0
##  3 &lt;NA&gt;             Afghanistan      1/24/20          0
##  4 &lt;NA&gt;             Afghanistan      1/25/20          0
##  5 &lt;NA&gt;             Afghanistan      1/26/20          0
##  6 &lt;NA&gt;             Afghanistan      1/27/20          0
##  7 &lt;NA&gt;             Afghanistan      1/28/20          0
##  8 &lt;NA&gt;             Afghanistan      1/29/20          0
##  9 &lt;NA&gt;             Afghanistan      1/30/20          0
## 10 &lt;NA&gt;             Afghanistan      1/31/20          0
## # … with 227,474 more rows
```
]

---
count: false
 
## Uso de pivot_wider() 
.line-space1-7[.font110[De forma análoga, la función `pivot_wider()` hará exactamente lo contrario, pasar de una data que se encuentre ordenada (**tidy data**), a una data ancha. Para esta función se tendrá que indicar los argumentos: `names_from` y `values_from`.]]
.panel1-pivot_wider_1-user[

```r
covid19_tidy %&gt;%
* pivot_wider(
*   names_from = "fecha",
*   values_from = "fallecidos"
* )
```
]
 
.panel2-pivot_wider_1-user[

```
## # A tibble: 284 × 803
##    `Province/State`          `Country/Region` `1/22/20`
##    &lt;chr&gt;                     &lt;chr&gt;                &lt;dbl&gt;
##  1 &lt;NA&gt;                      Afghanistan              0
##  2 &lt;NA&gt;                      Albania                  0
##  3 &lt;NA&gt;                      Algeria                  0
##  4 &lt;NA&gt;                      Andorra                  0
##  5 &lt;NA&gt;                      Angola                   0
##  6 &lt;NA&gt;                      Antarctica               0
##  7 &lt;NA&gt;                      Antigua and Bar…         0
##  8 &lt;NA&gt;                      Argentina                0
##  9 &lt;NA&gt;                      Armenia                  0
## 10 Australian Capital Terri… Australia                0
## # … with 274 more rows, and 800 more variables:
## #   `1/23/20` &lt;dbl&gt;, `1/24/20` &lt;dbl&gt;, `1/25/20` &lt;dbl&gt;,
## #   `1/26/20` &lt;dbl&gt;, `1/27/20` &lt;dbl&gt;, `1/28/20` &lt;dbl&gt;,
## #   `1/29/20` &lt;dbl&gt;, `1/30/20` &lt;dbl&gt;, `1/31/20` &lt;dbl&gt;,
## #   `2/1/20` &lt;dbl&gt;, `2/2/20` &lt;dbl&gt;, `2/3/20` &lt;dbl&gt;,
## #   `2/4/20` &lt;dbl&gt;, `2/5/20` &lt;dbl&gt;, `2/6/20` &lt;dbl&gt;,
## #   `2/7/20` &lt;dbl&gt;, `2/8/20` &lt;dbl&gt;, `2/9/20` &lt;dbl&gt;, …
```
]

&lt;style&gt;
.panel1-pivot_wider_1-user {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-pivot_wider_1-user {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-pivot_wider_1-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






&lt;style type="text/css"&gt;
.panel2-pivot_wider_1-user {
    height: 340px;
    overflow-y: auto !important;
}
&lt;/style&gt;

---
## ¡Hazlo tú mismo!

.line-space2-0[.font120[
1. Replica los procedimientos observados en las diapositivas
1. Genera un objeto tidy (`pivot_longer`)
1. Genera un objeto wider (`pivot_wider`)
]]

<div class="countdown" id="timer_6248bb38" style="right:0;bottom:0;margin:1em;font-size:4em;" data-warnwhen="30">
<code class="countdown-time"><span class="countdown-digits minutes">08</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
class: center, middle

# Retroalimentación


---
class: center, middle

&lt;br&gt;
&lt;center&gt;
&lt;h2&gt;
&lt;span style="color:#106075"&gt;¡Gracias!&lt;/span&gt;
&lt;/h2&gt;
&lt;br&gt;
&lt;h3&gt;
<span>&lt;i class="fas  fa-envelope fa-xs faa-float animated "&gt;&lt;/i&gt;&lt;a href="mailto:correo@gmail.com"&gt;&lt;span style="color:#562457"&gt;&amp;nbsp;&amp;nbsp;correo@gmail.com&lt;/span&gt;&lt;/a&gt;</span>
&lt;/h3&gt;
&lt;h3&gt;
<span>&lt;i class="fab  fa-github fa-xs faa-float animated "&gt;&lt;/i&gt;&lt;a href="https://github.com/healthinnovation/"&gt;&lt;span style="color:#562457"&gt;&amp;nbsp;&amp;nbsp; @healthinnovation&lt;/span&gt;&lt;/a&gt;</span>
&lt;/h3&gt;
&lt;h3&gt;
<span>&lt;i class="fab  fa-twitter fa-xs faa-float animated "&gt;&lt;/i&gt;&lt;a href="https://twitter.com/innovalab_imt"&gt;&lt;span style="color:#562457"&gt;&amp;nbsp;&amp;nbsp; @innovalab_imt&lt;/span&gt;&lt;/a&gt;</span>
&lt;/h3&gt;
&lt;/center&gt;

&lt;br&gt;

Estas diapositivas fueron creadas mediante el paquete [xaringan](https://github.com/yihui/xaringan) y [xaringanthemer](https://github.com/gadenbuie/xaringanthemer/).
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%/%total%",
"highlightStyle": "idea",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
